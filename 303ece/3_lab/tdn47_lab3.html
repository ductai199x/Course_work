<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Tai Duc Nguyen - ECE 303 - 04/18/2020</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
        <link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        
        <script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
    </head>
    <body class="vscode-light">
        <h2 id="tai-duc-nguyen---ece-303---04182020">Tai Duc Nguyen - ECE 303 - 04/18/2020</h2>
<h1 id="lab-3-memo">Lab 3 Memo</h1>
<ol>
<li><a href="#lab-3-memo">Lab 3 Memo</a>
<ol>
<li><a href="#lab-setup">Lab Setup</a></li>
<li><a href="#constructed-circuit">Constructed Circuit</a></li>
</ol>
</li>
</ol>
<h2 id="lab-setup">Lab Setup</h2>
<p>This lab setup feature the construction of a function generator using the Arduino Mega2560. The function being generated is a sine wave ranging from 0 to 5V. The frequency of the sine wave is determined by a potentiometer, or, input into the system using SCPI commands. Hence, the device being built needs to do 3 tasks:</p>
<ol>
<li>Sense the voltage difference (with regards to a reference voltage) created by a potentiometer.</li>
<li>Convert the voltage readings into sine wave frequency.</li>
<li>Generate a sine wave using PWM and the calculated frequency.</li>
</ol>
<p>The first tasks involve using the Arduino's ADC module, converting voltage readings (0-5V) into a 10-bit number. This is done using an interrupt and a timer running at ~ <strong>9.615kHz</strong>. This sampling rate is computed by taking the Arduino's clock freq of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>16</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding="application/x-tex">16\times 10^9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">9</span></span></span></span></span></span></span></span></span></span></span> Hz, dividing by the product of a prescaler, 128, and the number of cycles for a reading to be completed, 13. The reason for the prescaler to be 128 is due to the fact that in order for the arduino to output a 10-bit reading, the ratio of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mn>16</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><mtext>prescaler</mtext></mfrac></mrow><annotation encoding="application/x-tex">\frac{16\times 10^9}{\text{prescaler}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.499028em;vertical-align:-0.481108em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01792em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">prescaler</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span><span class="mbin mtight">×</span><span class="mord mtight">1</span><span class="mord mtight"><span class="mord mtight">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913142857142857em;"><span style="top:-2.931em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">9</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.481108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> needs to be between 50 and 200 kHz.</p>
<p>The second task is achieved by first mapping the 10-bit reading into a particular frequency number. The mapping method is linear mapping.</p>
<p>The third task comprises of using the calculated frequency number to index into a sine wave table, which tells the voltage the arduino should be generating. This number is converted to the duty cycle of a PWM signal so that the desired voltage can be acquired. The output of this signal is filtered through a LPF (using a R ~ 6.5<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi mathvariant="normal">Ω</mi></mrow><annotation encoding="application/x-tex">k\Omega</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord">Ω</span></span></span></span> and C ~ 0.1<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">\mu F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">μ</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span></span></span></span>), and used to control a LED. The design of this filter tries to accomplish a goal, which is attenuating anything &gt; <strong>8kHz (PWM rate, or, the filter's cutoff freq)</strong> to have a power of &lt; -33dB. However, since the filter is a very simple first-order-filter, the frequency remains in the signal will be around <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>c</mi></msub><mo>=</mo><mn>250</mn><mi>H</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">f_c=250Hz</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">5</span><span class="mord">0</span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span></span></span></span>. This means the 2 values for R and C is 6336<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Ω</mi></mrow><annotation encoding="application/x-tex">\Omega</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">Ω</span></span></span></span> and 0.1<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mi>F</mi></mrow><annotation encoding="application/x-tex">\mu F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">μ</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span></span></span></span>, respectively. The frequency of the PWM is chosen to be 8kHz because it is closest to the ADC sampling rate of 9.615kHz. Of course, this can be higher, but, since the ADC sampling rate is only 9.615kHz, a higher rate will only make the generated signal more smooth while the response to change in frequency is the same. If the PWM rate is lower than 8khz, then the generated signal will have a lower resolution.</p>
<h2 id="constructed-circuit">Constructed Circuit</h2>
<p><img src="file:////home/sweet/2-coursework/303ece/3_lab/20200427_034945.jpg" alt="circuit"></p>

    </body>
    </html>